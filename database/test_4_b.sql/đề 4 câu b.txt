SELECT 
    u.user_id,
    u.user_name,
    o.order_id,
    MIN(o.order_id) AS total_price,
    COUNT(oi.product_id) AS num_products
FROM 
    users u
JOIN 
    orders o ON u.user_id = o.user_id
JOIN 
    order_details oi ON o.order_id = oi.order_id
JOIN 
    products p ON oi.product_id = p.product_id
GROUP BY 
    u.user_id, u.user_name, o.order_id
ORDER BY 
    u.user_id;
